id: dashboard
type: PageHeaderMenu
properties:
  title: Dashboard

requests:
  _ref: requests/dashboard_requests.yaml

events:
  onMount:
    - id: get_book
      type: Request
      params: get_book
    - id: get_wiki
      type: Request
      params: get_wiki
    - id: get_task
      type: Request
      params: get_task
    - id: get_BT_entries
      type: Request
      params: get_BT_entries
    - id: get_tree
      type: Request
      params: get_tree

blocks:
  - id: default
    type: Breadcrumb
    properties:
      separator: '>'
      list:
        - label: Home
          pageId: home
        - label: Dashboard
          pageId: dashboard
  - id: tabs
    type: Tabs
    properties:
      defaultActiveKey: score_tab
      size: small
      tabPosition: left
      tabs:
        - key: score_tab
          title: Scores
          icon: AiOutlineExclamation
        - key: chart_tab
          title: Charts
          icon: AiFillCamera
        - key: memo_tab
          title: Memos
          icon: AiFillBell
        - key: record_tab
          title: Records
          icon: AiFillBell
    areas:
      score_tab:
        blocks:
          - id: score_wrapper
            type: Card
            properties:
              title: Scores
            layout:
              span: 6
              contentJustify: center
            blocks:
              - _ref:
                  path: components/date_selector.yaml
                  vars:
                    id: score_date

      chart_tab:
        blocks:
          - id: row1
            type: Box
            layout:
              contentGutter: 24
            blocks:
              - _ref: charts/line_chart1.yaml
              - _ref: charts/pie_chart1.yaml

          - id: divider1
            type: Divider

          - id: field_classes
            type: Collapse
            properties:
              accordion: true
              panels:
                - key: panel1
                  extraKey: panel1Extra
                  title: <h3>Maths Classification</h3>
                  disabled: false
                - key: panel2
                  title: <h3>Physics Classification</h3>
                  disabled: false
                  extraKey: null
                - key: panel3
                  disabled: false
                  title: <h3>Computer Science Classification</h3>
                  extraKey: null
            areas:
              panel1:
                blocks:
                  - _ref:
                      path: charts/field_tree_chart.yaml
                      vars:
                        id: maths_class_tree
                        field: maths
              panel2:
                blocks:
                  - _ref:
                      path: charts/field_tree_chart.yaml
                      vars:
                        id: physics_class_tree
                        field: physics
              panel3:
                blocks:
                  - _ref:
                      path: charts/field_tree_chart.yaml
                      vars:
                        id: computer_class_tree
                        field: computer

      memo_tab:
        blocks:
          - id: memo_wrapper
            type: Box
            layout:
              contentGutter: 20
            blocks:
              - id: memo_card1
                type: Card
                properties:
                  hoverable: true
                  title: Memo 1
                style:
                  maxWidth: 300
                blocks:
                  - id: memo_content1
                    type: Markdown
                    properties:
                      content: "**This is a markdown text.**"

              - id: memo_card2
                type: Card
                properties:
                  hoverable: true
                  title: Memo 2
                style:
                  maxWidth: 300
                blocks:
                  - id: memo_content2
                    type: Markdown
                    properties:
                      content: "**This is another markdown text.**"

      record_tab:
        blocks:
          - id: block_id
            type: Collapse
            properties:
              accordion: true
              bordered: false
              defaultActiveKey: panel1
              panels:
                - key: panel1
                  extraKey: panel1Extra
                  title: Info Sources
                  disabled: false
                - key: panel2
                  title: BT Entries
                  disabled: false
                  extraKey: panel2Extra

            areas:
              panel1:
                blocks:
                  - id: source_record_wrapper
                    type: Box
                    layout:
                      contentGutter: 20
                    blocks:
                      - id: source_selector
                        type: Selector
                        layout:
                          span: 4
                        properties:
                          label:
                            disabled: true
                          options:
                            - label: Textbook
                              value: book
                            - label: Wikipage
                              value: wiki
                          placeholder: Select a source to view
                        events:
                          onChange:
                            - id: set_source
                              type: SetState
                              params:
                                source:
                                  _state: source_selector

                      - id: query_button
                        type: Button
                        layout:
                          span: 2
                        properties:
                          color: "#ca7af0"
                          shape: round
                          title:
                            _string.concat:
                              - "Query: "
                              - _state: source
                        events:
                          onClick:
                            - id: set_source
                              type: SetState
                              params:
                                _state.query_source:
                                  _state: source_selector

                      - id: generate_csv
                        type: Button
                        layout:
                          span: 4
                        properties:
                          shape: round
                          title: Generate a CSV
                          color: '#1890ff'
                        events:
                          onClick:
                            - id: fetch_data
                              type: Request
                              params:
                                - get_task
                            - id: generate_csv
                              type: DownloadCsv
                              params:
                                filename: profiles.csv
                                data:
                                  _request: get_task
                                fields:
                                  - task
                                  - desc
                                  - priority

                      - _ref:
                          path: tables/source_record_table.yaml
                          vars:
                            table_id: source_record_table



              panel2:
                blocks:
                  - id: source_record_wrapper
                    type: Box
                    layout:
                      contentGutter: 20
                    blocks:
                      - id: BT_level_selector
                        type: Selector
                        layout:
                          span: 4
                        properties:
                          label:
                            disabled: true
                          options:
                            - label: lv1
                              value: 1
                            - label: lv2
                              value: 2
                            - label: lv3
                              value: 3
                            - label: lv4
                              value: 4
                            - label: lv5
                              value: 5
                            - label: lv6
                              value: 6
                          placeholder: Select a BT level

                      - id: BT_table
                        type: AgGridBalham
                        layout:
                          span: 6
                        properties:
                          enableCellTextSelection: true
                          pagination: true
                          rowData:
                            _request: get_BT_entries
                          defaultColDef:
                            sortable: true
                            resizable: true
                            filter: true
                          columnDefs:
                            - headerName: Date
                              field: date
                              flex: 2
                              filter: false
                            - headerName: BT Score
                              field: bt_score
                              flex: 1